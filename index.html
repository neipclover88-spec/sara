<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¶œì„ì²´í¬</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0d0f1a;
  --surface: #141726;
  --surface2: #1c2035;
  --border: #2a2f4a;
  --accent: #00e5a0;
  --accent2: #4d96ff;
  --accent3: #ffd93d;
  --danger: #ff6b6b;
  --text: #e8eaf0;
  --muted: #5a6080;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }
body { font-family:'Noto Sans KR',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; }

.nav {
  position: sticky; top: 0; z-index: 100;
  background: rgba(13,15,26,0.95); backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 0.8rem 1.5rem;
  display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap;
}
.nav-title { font-size: 1rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; }
.nav-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent); animation: pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.4;transform:scale(0.8)} }
.nav-month { display: flex; align-items: center; gap: 0.5rem; }
.month-btn { background: var(--surface); border: 1px solid var(--border); color: var(--text); width: 30px; height: 30px; border-radius: 7px; cursor: pointer; font-size: 1rem; transition: all 0.15s; display: flex; align-items: center; justify-content: center; }
.month-btn:hover { border-color: var(--accent); color: var(--accent); }
.month-label { font-family: 'DM Mono', monospace; font-size: 0.88rem; color: var(--accent); min-width: 90px; text-align: center; }
.sync-badge { font-family: 'DM Mono', monospace; font-size: 0.63rem; color: var(--accent); background: rgba(0,229,160,0.1); border: 1px solid rgba(0,229,160,0.2); padding: 0.2rem 0.6rem; border-radius: 100px; }
.sync-badge.err { color: var(--danger); background: rgba(255,107,107,0.1); border-color: rgba(255,107,107,0.2); }

.main { max-width: 1200px; margin: 0 auto; padding: 1.5rem; }

.name-selector {
  display: flex; align-items: center; gap: 0.7rem; flex-wrap: wrap;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 12px; padding: 0.9rem 1.2rem; margin-bottom: 1.5rem;
}
.name-label { font-size: 0.82rem; color: var(--muted); white-space: nowrap; }
.name-select {
  background: var(--surface2); border: 1px solid var(--border); color: var(--text);
  padding: 0.45rem 1rem; border-radius: 8px;
  font-family: 'Noto Sans KR', sans-serif; font-size: 0.82rem;
  cursor: pointer; outline: none; transition: border-color 0.15s;
}
.name-select:focus { border-color: var(--accent); }
.my-badge {
  font-size: 0.75rem; background: rgba(0,229,160,0.12); color: var(--accent);
  border: 1px solid rgba(0,229,160,0.25); padding: 0.25rem 0.8rem;
  border-radius: 100px; white-space: nowrap;
}
.hint-txt { font-size: 0.75rem; color: var(--muted); }

.calendar-section { margin-bottom: 2.5rem; }
.section-label { font-family: 'DM Mono', monospace; font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.15em; color: var(--muted); margin-bottom: 0.8rem; }
.weekday-row { display: grid; grid-template-columns: repeat(7,1fr); gap: 4px; margin-bottom: 4px; }
.weekday { text-align: center; font-size: 0.68rem; font-family: 'DM Mono', monospace; color: var(--muted); padding: 0.25rem; }
.weekday:first-child { color: #ff6b6b88; }
.weekday:last-child { color: #4d96ff88; }
.calendar-grid { display: grid; grid-template-columns: repeat(7,1fr); gap: 4px; }

.cal-cell {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 10px; padding: 0.6rem 0.4rem; min-height: 72px;
  cursor: pointer; transition: all 0.18s;
  display: flex; flex-direction: column; align-items: center; gap: 3px;
}
.cal-cell:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,229,160,0.1); }
.cal-cell.today { border-color: var(--accent); }
.cal-cell.today .cal-day { color: var(--accent); }
.cal-cell.empty { background: transparent; border-color: transparent; cursor: default; pointer-events: none; }
.cal-cell.my-checked { background: rgba(0,229,160,0.06); border-color: rgba(0,229,160,0.4); }
.cal-cell.holiday { border-color: rgba(255,107,107,0.3); }
.cal-cell.holiday .cal-day { color: #ff6b6b; }
.cal-day { font-size: 0.92rem; font-weight: 700; line-height: 1; }
.cal-cell.sun .cal-day { color: #ff6b6b; }
.cal-cell.sat .cal-day { color: var(--accent2); }
.cal-holiday { font-size: 0.55rem; color: #ff6b6b; text-align: center; line-height: 1.2; max-width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.cal-count { font-family: 'DM Mono', monospace; font-size: 0.65rem; color: var(--accent); background: rgba(0,229,160,0.1); padding: 0.1rem 0.4rem; border-radius: 100px; }
.cal-count.zero { color: var(--muted); background: transparent; }
.cal-dots { display: flex; flex-wrap: wrap; justify-content: center; gap: 2px; max-width: 36px; }
.cal-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--accent); opacity: 0.5; }

hr.divider { border: none; border-top: 1px solid var(--border); margin: 0.5rem 0 1.5rem; }

.att-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
.att-title { font-size: 1.1rem; font-weight: 700; }
.selected-badge {
  font-family: 'DM Mono', monospace; font-size: 0.72rem;
  color: var(--accent3); background: rgba(255,217,61,0.1);
  border: 1px solid rgba(255,217,61,0.2); padding: 0.28rem 0.8rem; border-radius: 100px;
}

.table-wrap { overflow-x: auto; border-radius: 12px; border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; }
thead tr th {
  background: var(--surface2);
  padding: 0.65rem 0.4rem;
  font-size: 0.68rem; font-family: 'DM Mono', monospace;
  color: var(--muted); border-bottom: 2px solid var(--border);
  white-space: nowrap; text-align: center;
}
thead tr th.name-col { text-align: left; padding-left: 1rem; min-width: 140px; color: var(--text); font-size: 0.75rem; }
thead tr th.total-col { color: var(--accent3); min-width: 55px; }
thead tr th.day-col { min-width: 32px; cursor: pointer; transition: color 0.15s; }
thead tr th.day-col:hover { color: var(--accent); }
thead tr th.today-col { color: var(--accent) !important; }
thead tr th.sun-col { color: #ff6b6b66; }
thead tr th.sat-col { color: #4d96ff66; }
thead tr th.holiday-col { color: #ff6b6b99 !important; }

tbody tr { border-bottom: 1px solid rgba(42,47,74,0.6); transition: background 0.12s; }
tbody tr:last-child { border-bottom: none; }
tbody tr.my-row { background: rgba(0,229,160,0.03); }
tbody tr:hover { background: rgba(255,255,255,0.02); }
tbody tr.stats-row { background: var(--surface2) !important; border-top: 2px solid var(--border); }

td { padding: 0.5rem 0.4rem; text-align: center; }
td.name-cell { text-align: left; padding-left: 1rem; font-size: 0.82rem; font-weight: 500; white-space: nowrap; }
td.name-cell.my-name { color: var(--accent); font-weight: 700; }
td.stat-cell { font-family: 'DM Mono', monospace; font-size: 0.65rem; color: var(--muted); }
td.stat-cell.has-cnt { color: var(--accent); font-weight: 500; }
.member-total { font-family: 'DM Mono', monospace; font-size: 0.7rem; color: var(--accent3); background: rgba(255,217,61,0.1); border: 1px solid rgba(255,217,61,0.2); padding: 0.1rem 0.45rem; border-radius: 100px; white-space: nowrap; }
.member-total.zero { color: var(--muted); background: transparent; border-color: transparent; }

.check-box {
  width: 18px; height: 18px; border-radius: 4px;
  border: 1.5px solid var(--border); background: transparent;
  cursor: pointer; appearance: none; -webkit-appearance: none;
  transition: all 0.13s; position: relative; display: block; margin: 0 auto;
}
.check-box:checked { background: var(--accent); border-color: var(--accent); }
.check-box:checked::after { content: ''; position: absolute; top: 2px; left: 4px; width: 6px; height: 9px; border: 2px solid #0d0f1a; border-top: none; border-left: none; transform: rotate(45deg); }
.check-box:disabled { opacity: 0.15; cursor: not-allowed; }
.check-box:hover:not(:checked):not(:disabled) { border-color: var(--accent); background: rgba(0,229,160,0.08); }

.loading { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 999; transition: opacity 0.4s; }
.loading.hidden { opacity: 0; pointer-events: none; }
.spinner { width: 32px; height: 32px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 1rem; }
.loading-txt { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--muted); }
@keyframes spin { to { transform: rotate(360deg); } }

@media (max-width: 600px) {
  .main { padding: 1rem; }
  .cal-cell { min-height: 56px; }
  .cal-day { font-size: 0.8rem; }
}
</style>
</head>
<body>

<div class="loading" id="loading">
  <div class="spinner"></div>
  <div class="loading-txt">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<nav class="nav">
  <div class="nav-title"><span class="nav-dot"></span>ì¶œì„ì²´í¬</div>
  <div class="nav-month">
    <button class="month-btn" onclick="changeMonth(-1)">â€¹</button>
    <span class="month-label" id="monthLabel"></span>
    <button class="month-btn" onclick="changeMonth(1)">â€º</button>
  </div>
  <span class="sync-badge" id="syncBadge">ì—°ê²° ì¤‘...</span>
</nav>

<div class="main">
  <div class="name-selector">
    <span class="name-label">ë‚´ ì´ë¦„ ì„ íƒ:</span>
    <select class="name-select" id="nameSelect" onchange="onNameChange()">
      <option value="">-- ì„ íƒ --</option>
    </select>
    <span class="my-badge" id="myBadge" style="display:none"></span>
    <span class="hint-txt" id="hintTxt">ì´ë¦„ì„ ì„ íƒí•˜ë©´ ë‹¬ë ¥ í´ë¦­ìœ¼ë¡œ ë°”ë¡œ ì²´í¬í•  ìˆ˜ ìˆì–´ìš”</span>
  </div>

  <div class="calendar-section">
    <div class="section-label" id="calLabel"></div>
    <div class="weekday-row">
      <div class="weekday">ì¼</div><div class="weekday">ì›”</div><div class="weekday">í™”</div>
      <div class="weekday">ìˆ˜</div><div class="weekday">ëª©</div><div class="weekday">ê¸ˆ</div><div class="weekday">í† </div>
    </div>
    <div class="calendar-grid" id="calGrid"></div>
  </div>

  <hr class="divider" id="divider">

  <div id="attSection">
    <div class="att-header">
      <div class="att-title">ì „ì²´ ì¶œì„ ê´€ë¦¬</div>
      <span class="selected-badge" id="selectedBadge" style="display:none"></span>
    </div>
    <div class="table-wrap">
      <table>
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// â”€â”€ Firebase ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const firebaseConfig = {
  apiKey: "AIzaSyAAbcRjELm-nN_f3XXgcn8eti2PHTMAIYM",
  authDomain: "sara-7bdd3.firebaseapp.com",
  projectId: "sara-7bdd3",
  storageBucket: "sara-7bdd3.firebasestorage.app",
  messagingSenderId: "964270515893",
  appId: "1:964270515893:web:b49b87e1c5c30873ba40fc"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// â”€â”€ ê³µíœ´ì¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const HOLIDAYS = {
  "2025": {
    "0": { 1: "ì‹ ì •" },
    "1": { 28: "ì„¤ë‚  ì „ë‚ ", 29: "ì„¤ë‚ ", 30: "ì„¤ë‚  ì—°íœ´" },
    "2": { 1: "ì‚¼ì¼ì ˆ" },
    "4": { 5: "ì–´ë¦°ì´ë‚ ", 6: "ëŒ€ì²´ê³µíœ´ì¼" },
    "5": { 6: "í˜„ì¶©ì¼" },
    "7": { 15: "ê´‘ë³µì ˆ" },
    "9": { 3: "ê°œì²œì ˆ", 5: "ì¶”ì„ì—°íœ´", 6: "ì¶”ì„", 7: "ì¶”ì„ì—°íœ´", 8: "ëŒ€ì²´ê³µíœ´ì¼", 9: "í•œê¸€ë‚ " },
    "11": { 25: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤" }
  },
  "2026": {
    "0": { 1: "ì‹ ì •" },
    "1": { 16: "ì„¤ë‚  ì—°íœ´", 17: "ì„¤ë‚ ", 18: "ì„¤ë‚  ì—°íœ´" },
    "2": { 1: "ì‚¼ì¼ì ˆ" },
    "4": { 5: "ì–´ë¦°ì´ë‚ ", 25: "ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ " },
    "5": { 6: "í˜„ì¶©ì¼" },
    "7": { 15: "ê´‘ë³µì ˆ" },
    "8": { 24: "ì¶”ì„ì—°íœ´", 25: "ì¶”ì„", 26: "ì¶”ì„ì—°íœ´" },
    "9": { 3: "ê°œì²œì ˆ", 9: "í•œê¸€ë‚ " },
    "11": { 25: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤" }
  }
};
function getHoliday(y, m, d) { return HOLIDAYS[String(y)]?.[String(m)]?.[d] || null; }

// â”€â”€ ë©¤ë²„ ëª©ë¡ (ê°€ë‚˜ë‹¤ ìˆœ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MEMBERS = [
  "ê·€ì—½ë™ì´ë§Œí•™ë„(ì¹˜/í•œ)",
  "ê¸ì •(ë©”ë””ì»¬)",
  "ë„ë¥´ë¥´(ë©”ë””ì»¬)",
  "ë‘ì½©(ì•½ëŒ€)",
  "ë£¨ë¹„(ë©”ë””ì»¬)",
  "ë¯¸ë†(í•œ/ì•½)",
  "ì‚¬ë¼(ì•½ëŒ€)",
  "ìŠ¤ì¹´í”¼(ë©”ë””ì»¬)",
  "ì—°ìš°(ê²½í•œ)",
  "ìŒì•…ë“£ëŠ” ì–´í”¼ì¹˜",
  "ì§€ë‹ˆ(ì˜ëŒ€)",
  "ì§„ì¸ì‚¬/ë‚¨/ê¸ˆ/ì‹œ/í˜‘",
  "ì²­ì†Œì˜¤ë¦¬/ì˜í•œì•½"
];

// â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const now = new Date();
let curYear = now.getFullYear();
let curMonth = now.getMonth();
let allData = {}; // allData[docId][memberKey] = true
let myName = localStorage.getItem('att_myname') || '';
const todayY = now.getFullYear(), todayM = now.getMonth(), todayD = now.getDate();

// â”€â”€ Firestore í‚¤ ë³€í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mKey(name) { return name.replace(/[^a-zA-Z0-9ê°€-í£ã„±-ã…ã…-ã…£]/g, '_'); }
function docId(y, m) { return `${y}_${String(m).padStart(2,'0')}`; } // e.g. "2026_02"

// â”€â”€ Firestore ë¦¬ìŠ¤ë„ˆ (ì›” ë‹¨ìœ„) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let unsubscribe = null;

function subscribeMonth(y, m) {
  if (unsubscribe) unsubscribe();
  const ref = doc(db, 'attendance', docId(y, m));
  unsubscribe = onSnapshot(ref, (snap) => {
    allData = snap.exists() ? snap.data() : {};
    render();
    document.getElementById('loading').classList.add('hidden');
    setSyncStatus(true);
  }, () => {
    document.getElementById('loading').classList.add('hidden');
    setSyncStatus(false);
  });
}

function setSyncStatus(ok) {
  const el = document.getElementById('syncBadge');
  el.textContent = ok ? 'â— ì‹¤ì‹œê°„ ì—°ê²°ë¨' : 'â— ì—°ê²° ì˜¤ë¥˜';
  el.classList.toggle('err', !ok);
}

// â”€â”€ ì €ì¥ (Firestore) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// êµ¬ì¡°: attendance/{year_month}/{day_memberKey} = true/false
async function saveCheck(y, m, d, member, checked) {
  const ref = doc(db, 'attendance', docId(y, m));
  const field = `d${d}_${mKey(member)}`;
  // ê¸°ì¡´ ë¬¸ì„œ ê°€ì ¸ì™€ì„œ ë³‘í•©
  const snap = await getDoc(ref);
  const data = snap.exists() ? snap.data() : {};
  if (checked) {
    data[field] = true;
  } else {
    delete data[field];
  }
  await setDoc(ref, data);
}

// â”€â”€ ì²´í¬ ì—¬ë¶€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function isChecked(d, member) {
  return !!(allData[`d${d}_${mKey(member)}`]);
}
function dayCount(d) {
  return MEMBERS.filter(m => isChecked(d, m)).length;
}

// â”€â”€ ì´ë¦„ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initNameSelect() {
  const sel = document.getElementById('nameSelect');
  MEMBERS.forEach(name => {
    const opt = document.createElement('option');
    opt.value = name; opt.textContent = name;
    if (name === myName) opt.selected = true;
    sel.appendChild(opt);
  });
  updateBadge();
}

window.onNameChange = function() {
  myName = document.getElementById('nameSelect').value;
  localStorage.setItem('att_myname', myName);
  updateBadge();
  render();
};

function updateBadge() {
  const badge = document.getElementById('myBadge');
  const hint = document.getElementById('hintTxt');
  if (myName) {
    badge.style.display = ''; badge.textContent = myName + ' ìœ¼ë¡œ ì²´í¬ ì¤‘ âœ“';
    hint.style.display = 'none';
  } else {
    badge.style.display = 'none'; hint.style.display = '';
  }
}

// â”€â”€ ì›” ë³€ê²½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.changeMonth = function(dir) {
  curMonth += dir;
  if (curMonth > 11) { curMonth = 0; curYear++; }
  if (curMonth < 0) { curMonth = 11; curYear--; }
  document.getElementById('loading').classList.remove('hidden');
  subscribeMonth(curYear, curMonth);
};

// â”€â”€ ì „ì²´ ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  const mn = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
  document.getElementById('monthLabel').textContent = `${curYear}ë…„ ${mn[curMonth]}`;
  document.getElementById('calLabel').textContent = `${curYear}ë…„ ${mn[curMonth]} ì¶œì„ ë‹¬ë ¥ â€” í´ë¦­í•˜ë©´ ë°”ë¡œ ì²´í¬!`;
  renderCalendar();
  renderTable();
}

// â”€â”€ ë‹¬ë ¥ ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCalendar() {
  const grid = document.getElementById('calGrid');
  grid.innerHTML = '';
  const firstDow = new Date(curYear, curMonth, 1).getDay();
  const daysInMonth = new Date(curYear, curMonth + 1, 0).getDate();

  for (let i = 0; i < firstDow; i++) {
    const e = document.createElement('div'); e.className = 'cal-cell empty'; grid.appendChild(e);
  }

  for (let d = 1; d <= daysInMonth; d++) {
    const dow = new Date(curYear, curMonth, d).getDay();
    const cnt = dayCount(d);
    const isTod = curYear===todayY && curMonth===todayM && d===todayD;
    const amIChecked = myName && isChecked(d, myName);
    const holiday = getHoliday(curYear, curMonth, d);

    const cell = document.createElement('div');
    let cls = 'cal-cell';
    if (dow===0) cls += ' sun';
    if (dow===6) cls += ' sat';
    if (isTod) cls += ' today';
    if (amIChecked) cls += ' my-checked';
    if (holiday) cls += ' holiday';
    cell.className = cls;

    const dots = Math.min(cnt, 9);
    cell.innerHTML = `
      <span class="cal-day">${d}</span>
      ${holiday ? `<span class="cal-holiday">${holiday}</span>` : ''}
      <span class="cal-count${cnt===0?' zero':''}">${cnt}ëª…</span>
      <div class="cal-dots">${'<div class="cal-dot"></div>'.repeat(dots)}</div>
    `;
    cell.addEventListener('click', () => calCellClick(d));
    grid.appendChild(cell);
  }
}

// â”€â”€ ë‹¬ë ¥ í´ë¦­ â†’ ë‚´ ì²´í¬ í† ê¸€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function calCellClick(day) {
  if (!myName) { alert('ë¨¼ì € ìœ„ì—ì„œ ë‚´ ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
  const current = isChecked(day, myName);
  await saveCheck(curYear, curMonth, day, myName, !current);
  scrollToDay(day);
}

function scrollToDay(day) {
  document.getElementById('divider').scrollIntoView({ behavior:'smooth', block:'start' });
  const badge = document.getElementById('selectedBadge');
  badge.style.display = ''; badge.textContent = `${curYear}ë…„ ${curMonth+1}ì›” ${day}ì¼`;
  setTimeout(() => {
    const th = document.querySelector(`#tableHead th[data-day="${day}"]`);
    if (th) th.scrollIntoView({ behavior:'smooth', block:'nearest', inline:'center' });
  }, 350);
}

// â”€â”€ í…Œì´ë¸” ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTable() {
  const daysInMonth = new Date(curYear, curMonth + 1, 0).getDate();
  const head = document.getElementById('tableHead');
  const body = document.getElementById('tableBody');

  // í—¤ë”
  let hHtml = '<tr><th class="name-col">ì´ë¦„</th>';
  for (let d = 1; d <= daysInMonth; d++) {
    const dow = new Date(curYear, curMonth, d).getDay();
    const isTod = curYear===todayY && curMonth===todayM && d===todayD;
    const holiday = getHoliday(curYear, curMonth, d);
    let cls = 'day-col';
    if (dow===0 || holiday) cls += ' sun-col';
    if (dow===6) cls += ' sat-col';
    if (isTod) cls += ' today-col';
    if (holiday) cls += ' holiday-col';
    hHtml += `<th class="${cls}" data-day="${d}" title="${holiday||''}">${d}${holiday?'ğŸ”´':''}</th>`;
  }
  hHtml += '<th class="total-col">ì´ë²ˆë‹¬</th></tr>';
  head.innerHTML = hHtml;

  // ë©¤ë²„ í–‰
  let bHtml = '';
  MEMBERS.forEach(member => {
    const isMe = member === myName;
    let total = 0;
    bHtml += `<tr class="${isMe?'my-row':''}">`;
    bHtml += `<td class="name-cell${isMe?' my-name':''}">${member}</td>`;
    for (let d = 1; d <= daysInMonth; d++) {
      const checked = isChecked(d, member);
      if (checked) total++;
      bHtml += `<td><input type="checkbox" class="check-box"
        ${checked?'checked':''}
        ${!isMe?'disabled':''}
        data-member="${member.replace(/"/g,'&quot;')}"
        data-day="${d}"
        onchange="handleTableCheck(this)"
      ></td>`;
    }
    bHtml += `<td><span class="member-total${total===0?' zero':''}">${total===0?'-':total+'íšŒ'}</span></td>`;
    bHtml += '</tr>';
  });

  // í•©ê³„ í–‰
  let grandTotal = 0;
  bHtml += '<tr class="stats-row"><td class="name-cell" style="font-size:0.7rem;color:var(--muted);font-family:\'DM Mono\',monospace">í•©ê³„</td>';
  for (let d = 1; d <= daysInMonth; d++) {
    const cnt = dayCount(d);
    grandTotal += cnt;
    bHtml += `<td class="stat-cell${cnt>0?' has-cnt':''}">${cnt||''}</td>`;
  }
  bHtml += `<td class="stat-cell has-cnt">${grandTotal}íšŒ</td>`;
  bHtml += '</tr>';

  body.innerHTML = bHtml;
}

// â”€â”€ í…Œì´ë¸” ì§ì ‘ ì²´í¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.handleTableCheck = async function(el) {
  if (!myName) { el.checked = !el.checked; alert('ë¨¼ì € ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
  await saveCheck(curYear, curMonth, parseInt(el.dataset.day), el.dataset.member, el.checked);
};

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
initNameSelect();
subscribeMonth(curYear, curMonth);
</script>
</body>
</html>
