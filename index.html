<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¶œì„ì²´í¬</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0d0f1a;
  --surface: #141726;
  --surface2: #1c2035;
  --border: #2a2f4a;
  --accent: #00e5a0;
  --accent2: #4d96ff;
  --accent3: #ffd93d;
  --danger: #ff6b6b;
  --text: #e8eaf0;
  --muted: #5a6080;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }
body { font-family:'Noto Sans KR',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; }

/* NAV */
.nav {
  position: sticky; top: 0; z-index: 100;
  background: rgba(13,15,26,0.95); backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 0.7rem 1.5rem;
  display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap;
}
.nav-title { font-size: 1rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; }
.nav-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent); animation: pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
.nav-month { display: flex; align-items: center; gap: 0.5rem; }
.month-btn { background: var(--surface); border: 1px solid var(--border); color: var(--text); width: 28px; height: 28px; border-radius: 7px; cursor: pointer; font-size: 1rem; transition: all 0.15s; display: flex; align-items: center; justify-content: center; }
.month-btn:hover { border-color: var(--accent); color: var(--accent); }
.month-label { font-family: 'DM Mono', monospace; font-size: 0.85rem; color: var(--accent); min-width: 88px; text-align: center; }
.sync-badge { font-family: 'DM Mono', monospace; font-size: 0.62rem; color: var(--accent); background: rgba(0,229,160,0.1); border: 1px solid rgba(0,229,160,0.2); padding: 0.18rem 0.6rem; border-radius: 100px; }
.sync-badge.err { color: var(--danger); background: rgba(255,107,107,0.1); border-color: rgba(255,107,107,0.2); }

.main { max-width: 1200px; margin: 0 auto; padding: 1.2rem 1.5rem; }

/* ì´ë¦„ ì„ íƒ ê·¸ë¦¬ë“œ */
.name-section {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 1rem 1.2rem; margin-bottom: 1.4rem;
}
.name-section-label {
  font-family: 'DM Mono', monospace; font-size: 0.65rem;
  text-transform: uppercase; letter-spacing: 0.12em;
  color: var(--muted); margin-bottom: 0.7rem;
}
.name-grid {
  display: flex; flex-wrap: wrap; gap: 0.45rem;
}
.name-chip {
  display: flex; align-items: center; gap: 0.4rem;
  padding: 0.38rem 0.75rem;
  background: var(--surface2); border: 1.5px solid var(--border);
  border-radius: 8px; cursor: pointer;
  font-size: 0.78rem; font-weight: 500;
  transition: all 0.15s; user-select: none;
  white-space: nowrap;
}
.name-chip:hover { border-color: #444b70; color: var(--text); transform: translateY(-1px); }
.name-chip.selected {
  border-color: var(--accent); background: rgba(0,229,160,0.1);
  color: var(--accent); font-weight: 700;
  box-shadow: 0 0 0 1px rgba(0,229,160,0.2);
}
.chip-emoji { font-size: 1rem; line-height: 1; }

/* ì„ íƒëœ ë©¤ë²„ í‘œì‹œ */
.selected-info {
  margin-top: 0.7rem; padding-top: 0.7rem;
  border-top: 1px solid var(--border);
  font-size: 0.75rem; color: var(--muted);
  display: none; align-items: center; gap: 0.5rem;
}
.selected-info.show { display: flex; }
.selected-info strong { color: var(--accent); }

/* ë‹¬ë ¥ */
.calendar-section { margin-bottom: 2rem; }
.section-label { font-family: 'DM Mono', monospace; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--muted); margin-bottom: 0.7rem; display: flex; align-items: center; flex-wrap: wrap; gap: 0.6rem; }
.cal-guide {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.82rem; font-weight: 700;
  letter-spacing: 0; text-transform: none;
  color: var(--accent);
  background: rgba(0,229,160,0.1);
  border: 1px solid rgba(0,229,160,0.3);
  padding: 0.25rem 0.8rem;
  border-radius: 100px;
  white-space: nowrap;
}
.weekday-row { display: grid; grid-template-columns: repeat(7,1fr); gap: 4px; margin-bottom: 4px; }
.weekday { text-align: center; font-size: 0.65rem; font-family: 'DM Mono', monospace; color: var(--muted); padding: 0.2rem; }
.weekday:first-child { color: #ff6b6b88; }
.weekday:last-child { color: #4d96ff88; }
.calendar-grid { display: grid; grid-template-columns: repeat(7,1fr); gap: 4px; }

.cal-cell {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 10px; padding: 0.5rem 0.3rem; min-height: 82px;
  cursor: pointer; transition: all 0.17s;
  display: flex; flex-direction: column; align-items: center; gap: 2px;
}
.cal-cell:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 4px 14px rgba(0,229,160,0.1); }
.cal-cell.today { border-color: var(--accent); }
.cal-cell.today .cal-day { color: var(--accent); }
.cal-cell.empty { background: transparent; border-color: transparent; cursor: default; pointer-events: none; }
.cal-cell.my-checked { background: rgba(0,229,160,0.05); border-color: rgba(0,229,160,0.4); }
.cal-cell.holiday .cal-day { color: #ff6b6b; }
.cal-cell.holiday { border-color: rgba(255,107,107,0.25); }
.cal-day { font-size: 0.88rem; font-weight: 700; line-height: 1; }
.cal-cell.sun .cal-day { color: #ff6b6b; }
.cal-cell.sat .cal-day { color: var(--accent2); }
.cal-holiday { font-size: 0.5rem; color: #ff6b6b; max-width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-align: center; }
.cal-count { font-family: 'DM Mono', monospace; font-size: 0.6rem; color: var(--accent); background: rgba(0,229,160,0.1); padding: 0.06rem 0.35rem; border-radius: 100px; }
.cal-count.zero { color: var(--muted); background: transparent; }

/* ì´ëª¨ì§€ ì ë“¤ */
.cal-emojis {
  display: flex; flex-wrap: wrap; justify-content: center;
  gap: 1px; max-width: 58px; margin-top: 1px; line-height: 1;
}
.cal-emoji {
  font-size: 0.75rem; cursor: default;
  transition: transform 0.12s;
  position: relative;
}
.cal-emoji:hover { transform: scale(1.5); z-index: 5; }

hr.divider { border: none; border-top: 1px solid var(--border); margin: 0.4rem 0 1.3rem; }

.att-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.8rem; flex-wrap: wrap; gap: 0.5rem; }
.att-title { font-size: 1.05rem; font-weight: 700; }
.selected-badge { font-family: 'DM Mono', monospace; font-size: 0.7rem; color: var(--accent3); background: rgba(255,217,61,0.1); border: 1px solid rgba(255,217,61,0.2); padding: 0.25rem 0.75rem; border-radius: 100px; }

.table-wrap { overflow-x: auto; border-radius: 12px; border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; }
thead tr th { background: var(--surface2); padding: 0.6rem 0.35rem; font-size: 0.65rem; font-family: 'DM Mono', monospace; color: var(--muted); border-bottom: 2px solid var(--border); white-space: nowrap; text-align: center; }
thead tr th.name-col { text-align: left; padding-left: 0.9rem; min-width: 145px; color: var(--text); font-size: 0.72rem; }
thead tr th.total-col { color: var(--accent3); min-width: 52px; }
thead tr th.day-col { min-width: 28px; cursor: pointer; transition: color 0.15s; }
thead tr th.day-col:hover { color: var(--accent); }
thead tr th.today-col { color: var(--accent) !important; }
thead tr th.sun-col { color: #ff6b6b55; }
thead tr th.sat-col { color: #4d96ff55; }
thead tr th.holiday-col { color: #ff6b6b88 !important; }

tbody tr { border-bottom: 1px solid rgba(42,47,74,0.5); transition: background 0.1s; }
tbody tr:last-child { border-bottom: none; }
tbody tr.my-row { background: rgba(0,229,160,0.03); }
tbody tr:hover { background: rgba(255,255,255,0.015); }
tbody tr.stats-row { background: var(--surface2) !important; border-top: 2px solid var(--border); }

td { padding: 0.45rem 0.35rem; text-align: center; }
td.name-cell { text-align: left; padding-left: 0.9rem; font-size: 0.8rem; font-weight: 500; white-space: nowrap; }
td.name-cell.my-name { color: var(--accent); font-weight: 700; }
.name-emoji-inline { font-size: 0.95rem; margin-right: 5px; }
td.stat-cell { font-family: 'DM Mono', monospace; font-size: 0.63rem; color: var(--muted); }
td.stat-cell.has-cnt { color: var(--accent); font-weight: 500; }
.member-total { font-family: 'DM Mono', monospace; font-size: 0.68rem; color: var(--accent3); background: rgba(255,217,61,0.1); border: 1px solid rgba(255,217,61,0.18); padding: 0.08rem 0.4rem; border-radius: 100px; white-space: nowrap; }
.member-total.zero { color: var(--muted); background: transparent; border-color: transparent; }

.check-box { width: 17px; height: 17px; border-radius: 4px; border: 1.5px solid var(--border); background: transparent; cursor: pointer; appearance: none; -webkit-appearance: none; transition: all 0.13s; position: relative; display: block; margin: 0 auto; }
.check-box:checked { background: var(--accent); border-color: var(--accent); }
.check-box:checked::after { content: ''; position: absolute; top: 2px; left: 3px; width: 5px; height: 8px; border: 2px solid #0d0f1a; border-top: none; border-left: none; transform: rotate(45deg); }
.check-box:disabled { opacity: 0.13; cursor: not-allowed; }
.check-box:hover:not(:checked):not(:disabled) { border-color: var(--accent); background: rgba(0,229,160,0.08); }

.loading { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 999; transition: opacity 0.4s; }
.loading.hidden { opacity: 0; pointer-events: none; }
.spinner { width: 30px; height: 30px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 1rem; }
.loading-txt { font-family: 'DM Mono', monospace; font-size: 0.7rem; color: var(--muted); }
@keyframes spin { to { transform: rotate(360deg); } }

@media (max-width: 600px) {
  .main { padding: 0.9rem 1rem; }
  .cal-cell { min-height: 68px; }
  .cal-day { font-size: 0.8rem; }
  .cal-emoji { font-size: 0.65rem; }
  .name-chip { font-size: 0.72rem; padding: 0.32rem 0.6rem; }
}
</style>
</head>
<body>

<div class="loading" id="loading">
  <div class="spinner"></div>
  <div class="loading-txt">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<nav class="nav">
  <div class="nav-title"><span class="nav-dot"></span>ì¶œì„ì²´í¬</div>
  <div class="nav-month">
    <button class="month-btn" onclick="changeMonth(-1)">â€¹</button>
    <span class="month-label" id="monthLabel"></span>
    <button class="month-btn" onclick="changeMonth(1)">â€º</button>
  </div>
  <span class="sync-badge" id="syncBadge">ì—°ê²° ì¤‘...</span>
</nav>

<div class="main">

  <!-- ì´ë¦„ ì„ íƒ -->
  <div class="name-section">
    <div class="name-section-label">ğŸ‘¤ ë‚´ ì´ë¦„ ì„ íƒ</div>
    <div class="name-grid" id="nameGrid"></div>
    <div class="selected-info" id="selectedInfo">
      <span>ì„ íƒë¨:</span>
      <strong id="selectedInfoText"></strong>
      <span style="color:var(--muted)">â€” ë‹¬ë ¥ ë‚ ì§œë¥¼ í´ë¦­í•˜ë©´ ë°”ë¡œ ì²´í¬ë¼ìš”</span>
    </div>
  </div>

  <!-- ë‹¬ë ¥ -->
  <div class="calendar-section">
    <div class="section-label" id="calLabel"></div>
    <div class="weekday-row">
      <div class="weekday">ì¼</div><div class="weekday">ì›”</div><div class="weekday">í™”</div>
      <div class="weekday">ìˆ˜</div><div class="weekday">ëª©</div><div class="weekday">ê¸ˆ</div><div class="weekday">í† </div>
    </div>
    <div class="calendar-grid" id="calGrid"></div>
  </div>

  <hr class="divider" id="divider">

  <div id="attSection">
    <div class="att-header">
      <div class="att-title">ì „ì²´ ì¶œì„ ê´€ë¦¬</div>
      <span class="selected-badge" id="selectedBadge" style="display:none"></span>
    </div>
    <div class="table-wrap">
      <table>
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAAbcRjELm-nN_f3XXgcn8eti2PHTMAIYM",
  authDomain: "sara-7bdd3.firebaseapp.com",
  projectId: "sara-7bdd3",
  storageBucket: "sara-7bdd3.firebasestorage.app",
  messagingSenderId: "964270515893",
  appId: "1:964270515893:web:b49b87e1c5c30873ba40fc"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// â”€â”€ ë©¤ë²„ + ì´ëª¨ì§€ (ê°€ë‚˜ë‹¤ìˆœ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MEMBERS = [
  { name: "ê·€ì—¼ë‘¥ì´ë§Œí•™ë„(ì¹˜/í•œ)", emoji: "ğŸ°" },
  { name: "ê¸ì •(ë©”ë””ì»¬)",          emoji: "ğŸŒ»" },
  { name: "ë„ë¡œë¡œ(ë©”ë””ì»¬)",         emoji: "ğŸ»" },
  { name: "ë‘ì½©(ì•½ëŒ€)",             emoji: "ğŸŸ¢" },
  { name: "ë£¨ë¹„(ë©”ë””ì»¬)",           emoji: "ğŸ’" },
  { name: "Rachel",                emoji: "ğŸŒ¸" },
  { name: "ì‚¬ë¼(ì•½ëŒ€)",             emoji: "â­" },
  { name: "ìŠ¤ì¹´í”¼(ë©”ë””ì»¬)",         emoji: "ğŸŒ™" },
  { name: "ì—°ìš°(ê²½í•œ)",             emoji: "ğŸ€" },
  { name: "ìŒì•…ë“£ëŠ” ì–´í”¼ì¹˜",        emoji: "ğŸ€" },
  { name: "ì§„ì¸ì‚¬/ë‚¨/ë‚¨êµ¬/ì‹œí—˜",    emoji: "ğŸŒˆ" },
  { name: "ì²­ì†Œì˜¤ë¦¬(ì˜í•œì•½)",       emoji: "ğŸ¥" },
  { name: "í¬ë¡±(í•œì˜ëŒ€)",           emoji: "ğŸµ" },
  { name: "í”¼ì¹´ì¸„(ì˜ëŒ€)",           emoji: "âœ¨" }
];

// â”€â”€ ê³µíœ´ì¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const HOLIDAYS = {
  "2025": {
    "0":{1:"ì‹ ì •"}, "1":{28:"ì„¤ë‚ ì „ë‚ ",29:"ì„¤ë‚ ",30:"ì„¤ë‚ ì—°íœ´"},
    "2":{1:"ì‚¼ì¼ì ˆ"}, "4":{5:"ì–´ë¦°ì´ë‚ ",6:"ëŒ€ì²´ê³µíœ´ì¼"},
    "5":{6:"í˜„ì¶©ì¼"}, "7":{15:"ê´‘ë³µì ˆ"},
    "9":{3:"ê°œì²œì ˆ",5:"ì¶”ì„ì—°íœ´",6:"ì¶”ì„",7:"ì¶”ì„ì—°íœ´",8:"ëŒ€ì²´ê³µíœ´ì¼",9:"í•œê¸€ë‚ "},
    "11":{25:"í¬ë¦¬ìŠ¤ë§ˆìŠ¤"}
  },
  "2026": {
    "0":{1:"ì‹ ì •"}, "1":{16:"ì„¤ë‚ ì—°íœ´",17:"ì„¤ë‚ ",18:"ì„¤ë‚ ì—°íœ´"},
    "2":{1:"ì‚¼ì¼ì ˆ"}, "4":{5:"ì–´ë¦°ì´ë‚ ",25:"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ "},
    "5":{6:"í˜„ì¶©ì¼"}, "7":{15:"ê´‘ë³µì ˆ"},
    "8":{24:"ì¶”ì„ì—°íœ´",25:"ì¶”ì„",26:"ì¶”ì„ì—°íœ´"},
    "9":{3:"ê°œì²œì ˆ",9:"í•œê¸€ë‚ "}, "11":{25:"í¬ë¦¬ìŠ¤ë§ˆìŠ¤"}
  }
};
function getHoliday(y,m,d){ return HOLIDAYS[String(y)]?.[String(m)]?.[d]||null; }

// â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const now = new Date();
let curYear = now.getFullYear();
let curMonth = now.getMonth();
let allData = {};
let myName = localStorage.getItem('att_myname') || '';
const todayY=now.getFullYear(), todayM=now.getMonth(), todayD=now.getDate();

function mKey(name){ return name.replace(/[^a-zA-Z0-9ê°€-í£ã„±-ã…ã…-ã…£]/g,'_'); }
function docId(y,m){ return `${y}_${String(m).padStart(2,'0')}`; }
function memberEmoji(name){ return MEMBERS.find(m=>m.name===name)?.emoji||'ğŸ‘¤'; }

// â”€â”€ Firestore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let unsubscribe = null;
function subscribeMonth(y,m){
  if(unsubscribe) unsubscribe();
  const r = doc(db,'attendance',docId(y,m));
  unsubscribe = onSnapshot(r,(snap)=>{
    allData = snap.exists() ? snap.data() : {};
    render();
    document.getElementById('loading').classList.add('hidden');
    setSyncStatus(true);
  },()=>{ document.getElementById('loading').classList.add('hidden'); setSyncStatus(false); });
}
function setSyncStatus(ok){
  const el=document.getElementById('syncBadge');
  el.textContent=ok?'â— ì‹¤ì‹œê°„ ì—°ê²°ë¨':'â— ì—°ê²° ì˜¤ë¥˜';
  el.classList.toggle('err',!ok);
}
async function saveCheck(y,m,d,name,checked){
  const r=doc(db,'attendance',docId(y,m));
  const field=`d${d}_${mKey(name)}`;
  const snap=await getDoc(r);
  const data=snap.exists()?snap.data():{};
  if(checked) data[field]=true; else delete data[field];
  await setDoc(r,data);
}
function isChecked(d,name){ return !!(allData[`d${d}_${mKey(name)}`]); }
function dayCheckedMembers(d){ return MEMBERS.filter(m=>isChecked(d,m.name)); }

// â”€â”€ ì´ë¦„ ì¹© ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderNameGrid(){
  const grid=document.getElementById('nameGrid');
  grid.innerHTML = MEMBERS.map(m=>`
    <div class="name-chip${m.name===myName?' selected':''}" onclick="selectName('${m.name.replace(/'/g,"\\'")}')">
      <span class="chip-emoji">${m.emoji}</span>${m.name}
    </div>
  `).join('');

  const info=document.getElementById('selectedInfo');
  const infoTxt=document.getElementById('selectedInfoText');
  if(myName){
    info.classList.add('show');
    infoTxt.textContent=`${memberEmoji(myName)} ${myName}`;
  } else {
    info.classList.remove('show');
  }
}

window.selectName = function(name){
  myName = (myName===name) ? '' : name; // ê°™ì€ê±° ëˆ„ë¥´ë©´ í•´ì œ
  localStorage.setItem('att_myname', myName);
  renderNameGrid();
  render();
};

// â”€â”€ ì›” ë³€ê²½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.changeMonth = function(dir){
  curMonth+=dir;
  if(curMonth>11){curMonth=0;curYear++;}
  if(curMonth<0){curMonth=11;curYear--;}
  document.getElementById('loading').classList.remove('hidden');
  subscribeMonth(curYear,curMonth);
};

// â”€â”€ ì „ì²´ ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(){
  const mn=['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
  document.getElementById('monthLabel').textContent=`${curYear}ë…„ ${mn[curMonth]}`;
  document.getElementById('calLabel').innerHTML=`${curYear}ë…„ ${mn[curMonth]} ì¶œì„ ë‹¬ë ¥ &nbsp;<span class="cal-guide">ğŸ‘† ë‹‰ë„¤ì„ ì„ íƒ í›„ ë‚ ì§œ í´ë¦­ = ìë™ ì¶œì„ì²´í¬!</span>`;
  renderNameGrid();
  renderCalendar();
  renderTable();
}

// â”€â”€ ë‹¬ë ¥ ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCalendar(){
  const grid=document.getElementById('calGrid');
  grid.innerHTML='';
  const firstDow=new Date(curYear,curMonth,1).getDay();
  const dim=new Date(curYear,curMonth+1,0).getDate();

  for(let i=0;i<firstDow;i++){
    const e=document.createElement('div'); e.className='cal-cell empty'; grid.appendChild(e);
  }

  for(let d=1;d<=dim;d++){
    const dow=new Date(curYear,curMonth,d).getDay();
    const checked=dayCheckedMembers(d);
    const cnt=checked.length;
    const isTod=curYear===todayY&&curMonth===todayM&&d===todayD;
    const amI=myName&&isChecked(d,myName);
    const holiday=getHoliday(curYear,curMonth,d);

    const cell=document.createElement('div');
    let cls='cal-cell';
    if(dow===0) cls+=' sun';
    if(dow===6) cls+=' sat';
    if(isTod) cls+=' today';
    if(amI) cls+=' my-checked';
    if(holiday) cls+=' holiday';
    cell.className=cls;

    const emojisHtml = checked.map(m=>
      `<span class="cal-emoji" title="${m.name}">${m.emoji}</span>`
    ).join('');

    cell.innerHTML=`
      <span class="cal-day">${d}</span>
      ${holiday?`<span class="cal-holiday">${holiday}</span>`:''}
      <span class="cal-count${cnt===0?' zero':''}">${cnt>0?cnt+'ëª…':'Â·'}</span>
      <div class="cal-emojis">${emojisHtml}</div>
    `;
    cell.addEventListener('click',()=>calClick(d));
    grid.appendChild(cell);
  }
}

async function calClick(day){
  if(!myName){ alert('ë¨¼ì € ìœ„ì—ì„œ ë‚´ ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
  await saveCheck(curYear,curMonth,day,myName,!isChecked(day,myName));
  scrollToDay(day);
}

function scrollToDay(day){
  document.getElementById('divider').scrollIntoView({behavior:'smooth',block:'start'});
  const badge=document.getElementById('selectedBadge');
  badge.style.display=''; badge.textContent=`${curYear}ë…„ ${curMonth+1}ì›” ${day}ì¼`;
  setTimeout(()=>{
    const th=document.querySelector(`#tableHead th[data-day="${day}"]`);
    if(th) th.scrollIntoView({behavior:'smooth',block:'nearest',inline:'center'});
  },350);
}

// â”€â”€ í…Œì´ë¸” ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTable(){
  const dim=new Date(curYear,curMonth+1,0).getDate();
  const head=document.getElementById('tableHead');
  const body=document.getElementById('tableBody');

  let hHtml='<tr><th class="name-col">ì´ë¦„</th>';
  for(let d=1;d<=dim;d++){
    const dow=new Date(curYear,curMonth,d).getDay();
    const isTod=curYear===todayY&&curMonth===todayM&&d===todayD;
    const holiday=getHoliday(curYear,curMonth,d);
    let cls='day-col';
    if(dow===0||holiday) cls+=' sun-col';
    if(dow===6) cls+=' sat-col';
    if(isTod) cls+=' today-col';
    if(holiday) cls+=' holiday-col';
    hHtml+=`<th class="${cls}" data-day="${d}" title="${holiday||''}">${d}${holiday?'ğŸ”´':''}</th>`;
  }
  hHtml+='<th class="total-col">ì´ë²ˆë‹¬</th></tr>';
  head.innerHTML=hHtml;

  let bHtml='';
  MEMBERS.forEach(({name,emoji})=>{
    const isMe=name===myName;
    let total=0;
    bHtml+=`<tr class="${isMe?'my-row':''}">`;
    bHtml+=`<td class="name-cell${isMe?' my-name':''}"><span class="name-emoji-inline">${emoji}</span>${name}</td>`;
    for(let d=1;d<=dim;d++){
      const checked=isChecked(d,name);
      if(checked) total++;
      bHtml+=`<td><input type="checkbox" class="check-box"
        ${checked?'checked':''}
        ${!isMe?'disabled':''}
        data-member="${name.replace(/"/g,'&quot;')}"
        data-day="${d}"
        onchange="handleTableCheck(this)"
      ></td>`;
    }
    bHtml+=`<td><span class="member-total${total===0?' zero':''}">${total===0?'-':total+'íšŒ'}</span></td>`;
    bHtml+='</tr>';
  });

  let grand=0;
  bHtml+='<tr class="stats-row"><td class="name-cell" style="font-size:0.68rem;color:var(--muted);font-family:\'DM Mono\',monospace">í•©ê³„</td>';
  for(let d=1;d<=dim;d++){
    const cnt=dayCheckedMembers(d).length; grand+=cnt;
    bHtml+=`<td class="stat-cell${cnt>0?' has-cnt':''}">${cnt||''}</td>`;
  }
  bHtml+=`<td class="stat-cell has-cnt">${grand}íšŒ</td></tr>`;
  body.innerHTML=bHtml;
}

window.handleTableCheck = async function(el){
  if(!myName){ el.checked=!el.checked; alert('ë¨¼ì € ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
  await saveCheck(curYear,curMonth,parseInt(el.dataset.day),el.dataset.member,el.checked);
};

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subscribeMonth(curYear,curMonth);
</script>
</body>
</html>
